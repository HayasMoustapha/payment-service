{
	"info": {
		"_postman_id": "payment-service-collection",
		"name": "Payment Service - Technical API",
		"description": "Collection compl√®te pour Payment Service (Port 3003). Service technique de traitement des paiements.\n\nüî• R√àGLE STRICTE: Service technique - PAS d'authentification utilisateur.\nLes bodies ne contiennent QUE les champs r√©els des sch√©mas SQL.\n‚ùå INTERDITS: id, created_at, updated_at (g√©r√©s automatiquement)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3003/api",
			"type": "string"
		},
		{
			"key": "testPaymentId",
			"value": "550e8400-e29b-41d4-a716-446655440000",
			"type": "string"
		},
		{
			"key": "testTemplateId",
			"value": "550e8400-e29b-41d4-a716-446655440001",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "üí≥ Payments",
			"item": [
				{
					"name": "Process Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Payment processed successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('status');",
									"});",
									"",
									"// Store payment ID for future tests",
									"if (pm.response.json().data && pm.response.json().data.id) {",
									"    pm.variables.set('testPaymentId', pm.response.json().data.id);",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"amount\": 29.99,\n  \"currency\": \"eur\",\n  \"gateway\": \"stripe\",\n  \"customerEmail\": \"customer@example.com\",\n  \"description\": \"Achat template premium\",\n  \"metadata\": {\n    \"source\": \"marketplace\",\n    \"template_id\": \"123\"\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/payments/process",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payments",
								"process"
							]
						}
					},
					"response": []
				},
				{
					"name": "Purchase Template",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Template purchased successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('transaction_id');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"templateId\": \"{{testTemplateId}}\",\n  \"customerEmail\": \"buyer@example.com\",\n  \"paymentMethod\": \"stripe\",\n  \"amount\": 49.99,\n  \"currency\": \"eur\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/payments/templates/purchase",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payments",
								"templates",
								"purchase"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Payment Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payment status retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('status');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payments/{{testPaymentId}}/status",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payments",
								"{{testPaymentId}}",
								"status"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Payments",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payments retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payments?status=completed&gateway=stripe&limit=20&offset=0",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payments"
							],
							"query": [
								{
									"key": "status",
									"value": "completed"
								},
								{
									"key": "gateway",
									"value": "stripe"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "offset",
									"value": "0"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Payment Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payment details retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('amount');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payments/{{testPaymentId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payments",
								"{{testPaymentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Cancel Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payment cancelled successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"reason\": \"Annulation par le client\",\n  \"refundAmount\": 29.99\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/payments/{{testPaymentId}}/cancel",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payments",
								"{{testPaymentId}}",
								"cancel"
							]
						}
					},
					"response": []
				}
			],
			"description": "Traitement technique des paiements avec multiples passerelles"
		},
		{
			"name": "üí≥ Wallets",
			"item": [
				{
					"name": "Create Wallet",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Wallet created successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('balance');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"550e8400-e29b-41d4-a716-446655440002\",\n  \"user_type\": \"designer\",\n  \"currency\": \"EUR\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/wallets",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"wallets"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Wallet By User ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Wallet retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('balance');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/wallets/user/550e8400-e29b-41d4-a716-446655440002",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"wallets",
								"user",
								"550e8400-e29b-41d4-a716-446655440002"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Wallet Balance",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Wallet balance retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('balance');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/wallets/550e8400-e29b-41d4-a716-446655440003/balance",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"wallets",
								"550e8400-e29b-41d4-a716-446655440003",
								"balance"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Wallet Transactions",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Wallet transactions retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/wallets/550e8400-e29b-41d4-a716-446655440003/transactions?limit=50",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"wallets",
								"550e8400-e29b-41d4-a716-446655440003",
								"transactions"
							],
							"query": [
								{
									"key": "limit",
									"value": "50"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Request Withdrawal",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Withdrawal requested successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"wallet_id\": \"550e8400-e29b-41d4-a716-446655440003\",\n  \"amount\": 250.00,\n  \"withdrawal_method\": \"bank_account\",\n  \"withdrawal_details\": {\n    \"bank_name\": \"BNP Paribas\",\n    \"account_number\": \"FR7630004000031234567890143\",\n    \"account_holder\": \"Jean Designer\",\n    \"iban\": \"FR7630004000031234567890143\"\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/wallets/withdrawals",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"wallets",
								"withdrawals"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Withdrawals",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Withdrawals retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/wallets/withdrawals?status=pending&limit=20",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"wallets",
								"withdrawals"
							],
							"query": [
								{
									"key": "status",
									"value": "pending"
								},
								{
									"key": "limit",
									"value": "20"
								}
							]
						}
					},
					"response": []
				}
			],
			"description": "Gestion des wallets et retraits pour designers/organisateurs"
		},
		{
			"name": "üí≥ Refunds",
			"item": [
				{
					"name": "Create Refund",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Refund created successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"transaction_id\": \"{{testPaymentId}}\",\n  \"amount\": 29.99,\n  \"reason\": \"Client non satisfait du template\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/refunds",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"refunds"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Refund By ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Refund retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/refunds/550e8400-e29b-41d4-a716-446655440004",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"refunds",
								"550e8400-e29b-41d4-a716-446655440004"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Refunds by Transaction",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Refunds retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/refunds/transaction/{{testPaymentId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"refunds",
								"transaction",
								"{{testPaymentId}}"
							]
						}
					},
					"response": []
				}
			],
			"description": "Gestion des remboursements"
		},
		{
			"name": "üí≥ Payment Gateways",
			"item": [
				{
					"name": "Get Payment Gateways",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payment gateways retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payment-gateways?active=true",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payment-gateways"
							],
							"query": [
								{
									"key": "active",
									"value": "true"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Payment Gateway By Code",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Payment gateway retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('code');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/payment-gateways/stripe",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"payment-gateways",
								"stripe"
							]
						}
					},
					"response": []
				}
			],
			"description": "Configuration des passerelles de paiement"
		}
	]
}
